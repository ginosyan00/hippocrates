// Hippocrates Dental - Database Schema
// Provider: SQLite (для MVP)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// CLINIC (Клиника)
// ============================================

model Clinic {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  email         String
  phone         String
  address       String?
  city          String
  about         String?
  logo          String?
  workingHours  String?   // JSON as String in SQLite
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  users         User[]
  patients      Patient[]
  appointments  Appointment[]

  @@map("clinics")
}

// ============================================
// USER (Сотрудник)
// ============================================

model User {
  id             String    @id @default(uuid())
  clinicId       String
  name           String
  email          String    @unique
  passwordHash   String
  role           String  // admin | doctor | assistant
  specialization String?
  phone          String?
  avatar         String?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  clinic         Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  appointments   Appointment[]

  @@index([clinicId])
  @@index([email])
  @@map("users")
}

// ============================================
// PATIENT (Пациент)
// ============================================

model Patient {
  id           String    @id @default(uuid())
  clinicId     String
  name         String
  phone        String
  email        String?
  dateOfBirth  DateTime?
  gender       String?  // male | female | other
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  clinic       Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  appointments Appointment[]

  @@index([clinicId])
  @@index([phone])
  @@map("patients")
}

// ============================================
// APPOINTMENT (Приём)
// ============================================

model Appointment {
  id              String    @id @default(uuid())
  clinicId        String
  doctorId        String
  patientId       String
  appointmentDate DateTime
  duration        Int       @default(30)
  status          String  @default("pending")  // pending | confirmed | completed | cancelled
  notes           String?
  reason          String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  clinic          Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  doctor          User      @relation(fields: [doctorId], references: [id])
  patient         Patient   @relation(fields: [patientId], references: [id])

  @@index([clinicId])
  @@index([doctorId])
  @@index([patientId])
  @@index([appointmentDate])
  @@index([status])
  @@map("appointments")
}

